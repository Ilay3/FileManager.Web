@model FileManager.Application.DTOs.TreeNodeDto

@if (Model.Children.Any())
{
    <table class="files-table">
        <thead>
            <tr>
                <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                <th>–†–∞–∑–º–µ—Ä</th>
                <th>–ò–∑–º–µ–Ω–µ–Ω</th>
                <th>–ê–≤—Ç–æ—Ä</th>
                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
            </tr>
        </thead>
        <tbody>
        @foreach (var item in Model.Children)
        {
            <tr class="explorer-item" data-type="@item.Type" data-id="@item.Id" data-name="@item.Name">
                <td>
                    <span class="file-icon">@item.Icon</span>
                    @if (item.Type == "folder")
                    {
                        <a href="?folderId=@item.Id&view=list">@item.Name</a>
                    }
                    else
                    {
                        <span>@item.Name</span>
                    }
                </td>
                <td>
                    @(item.Type == "file" && item.SizeBytes.HasValue ? FormatSize(item.SizeBytes.Value) : "-")
                </td>
                <td>@((item.UpdatedAt ?? item.CreatedAt).ToString("dd.MM.yyyy HH:mm"))</td>
                <td>@item.UploadedByName</td>
                <td>
                    <div class="action-buttons">
                        @if (item.Type == "file")
                        {
                            <button class="btn btn-small" onclick="viewFile('@item.Id')" title="–ü—Ä–æ—Å–º–æ—Ç—Ä">üëÅÔ∏è</button>
                            <button class="btn btn-small" onclick="downloadFile('@item.Id')" title="–°–∫–∞—á–∞—Ç—å">‚¨áÔ∏è</button>
                            <button class="btn btn-small" onclick="deleteFile('@item.Id', '@item.Name')" title="–£–¥–∞–ª–∏—Ç—å">üóëÔ∏è</button>
                        }
                        else
                        {
                            <button class="btn btn-small" onclick="openRenameFolderModal('@item.Id', '@item.Name')" title="–ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å">‚úèÔ∏è</button>
                            <button class="btn btn-small" onclick="deleteFolder('@item.Id', '@item.Name')" title="–£–¥–∞–ª–∏—Ç—å">üóëÔ∏è</button>
                        }
                    </div>
                </td>
            </tr>
        }
        </tbody>
    </table>
}
else
{
    <div class="empty-state">
        <div style="font-size: 64px; margin-bottom: 20px;">üìÅ</div>
        <h3>–ü–∞–ø–∫–∞ –ø—É—Å—Ç–∞</h3>
        <p style="color: #999; margin-bottom: 30px;">–í –¥–∞–Ω–Ω–æ–π –ø–∞–ø–∫–µ –Ω–µ—Ç —Ñ–∞–π–ª–æ–≤ –∏–ª–∏ –ø–æ–¥–ø–∞–ø–æ–∫</p>
    </div>
}

@functions {
    private string FormatSize(long size)
    {
        string[] suffix = { "–ë", "–ö–ë", "–ú–ë", "–ì–ë", "–¢–ë" };
        double len = size;
        int order = 0;
        while (len >= 1024 && order < suffix.Length - 1)
        {
            order++;
            len = len / 1024;
        }
        return $"{len:0.##} {suffix[order]}";
    }
}
