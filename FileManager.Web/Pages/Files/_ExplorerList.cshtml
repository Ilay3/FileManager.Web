@model FileManager.Application.DTOs.TreeNodeDto

@if (Model.Children.Any())
{
    <div class="tiles-list">
    @foreach (var item in Model.Children)
    {
        <div class="tile-row explorer-item" data-type="@item.Type" data-id="@item.Id" data-name="@item.Name">
            <div class="tile-icon">
                <i class="@item.IconClass"></i>
                @if (item.IsNetworkAvailable)
                {
                    <i class="bi bi-cloud-check network-icon"></i>
                }
            </div>
            <div class="tile-body">
                <div class="tile-name">
                    @if (item.Type == "folder")
                    {
                        <a href="?folderId=@item.Id&view=list">@item.Name</a>
                    }
                    else
                    {
                        <span>@item.Name</span>
                    }
                </div>
                <div class="tile-meta">
                    @(item.Type == "file" && item.SizeBytes.HasValue ? FormatSize(item.SizeBytes.Value) : "-") · @((item.UpdatedAt ?? item.CreatedAt).ToString("dd.MM.yyyy HH:mm")) · @item.UploadedByName
                </div>
            </div>
            <div class="tile-actions">
                @if (item.Type == "file")
                {
                    <button class="btn btn-small" onclick="viewFile('@item.Id')" title="Просмотр"><i class="bi bi-eye"></i></button>
                    <button class="btn btn-small" onclick="downloadFile('@item.Id')" title="Скачать"><i class="bi bi-download"></i></button>
                    <button class="btn btn-small" onclick="deleteFile('@item.Id', '@item.Name')" title="Удалить"><i class="bi bi-trash"></i></button>
                }
                else
                {
                    <button class="btn btn-small" onclick="openRenameFolderModal('@item.Id', '@item.Name')" title="Переименовать"><i class="bi bi-pencil"></i></button>
                    <button class="btn btn-small" onclick="deleteFolder('@item.Id', '@item.Name')" title="Удалить"><i class="bi bi-trash"></i></button>
                }
            </div>
        </div>
    }
    </div>
}
else
{
    <div class="empty-state">
        <div style="font-size: 64px; margin-bottom: 20px;"><i class="bi bi-folder"></i></div>
        <h3>Папка пуста</h3>
        <p style="color: #999; margin-bottom: 30px;">В данной папке нет файлов или подпапок</p>
    </div>
}

@functions {
    private string FormatSize(long size)
    {
        string[] suffix = { "Б", "КБ", "МБ", "ГБ", "ТБ" };
        double len = size;
        int order = 0;
        while (len >= 1024 && order < suffix.Length - 1)
        {
            order++;
            len = len / 1024;
        }
        return $"{len:0.##} {suffix[order]}";
    }
}
